package core;
import java.io.File;
import java.io.FileWriter;
import java.io.StringWriter;
import java.util.ArrayList;

import org.xmlpull.v1.XmlSerializer;

import android.graphics.Color;
import android.os.Environment;
import android.util.Xml;

public class ListItem 
{
	
	//Attributs & Constructor
	String listName;
	String listColor;
	ArrayList<Item> list = new ArrayList<Item>();
	final static String files_directory = "/storage/extSdCard/MM/ITEMS";
	final static String project_directory = "/storage/MM";
	public ListItem(String listName, String listColor) 
	{
		this.listName = listName;
		this.listColor = listColor;
		//save();
	}
	public ListItem(String listName) 
	{
		load(listName);
	}
	
	
	//Core Functions
	public void addItem(String data)
	{
		this.list.add(new Item(data));
		//save();
	}
	public void removeItem(String data)
	{
		int tmp = findItem(data);
		if (tmp > -1)
			this.list.remove(tmp);
		//save();
	}
	public int findItem(String data)
	{
		for (int i=0;i<list.size();i++)
		{
			if (list.get(i).toString() == data ) 
				return i;
		}
		return -1;
	}
	@Override
	public String toString() 
	{
		return "ListItem [listName=" + listName + ", listColor=" + listColor
				+ ", list=" + list + "]";
	}
	public void load(String listName)
	{
		
	}
	public boolean save()
	{
		 File project_folder = new File(ListItem.project_directory);
		 project_folder.mkdirs();
		 File item_folder = new File(ListItem.files_directory);
		 item_folder.mkdirs();
		 XmlSerializer serializer = Xml.newSerializer();
		 StringWriter writer = new StringWriter();
		 try {
				 serializer.setOutput(writer);
			     serializer.startDocument("UTF-8", true);
			     serializer.startTag("", "XML");
				     serializer.startTag("", "NameList");
				     	serializer.text(this.getListName());
				     serializer.endTag("", "NameList");
				     serializer.startTag("", "ColorList");
				     	serializer.text(this.getListColor().toString());
				     serializer.endTag("", "ColorList");				     
				     serializer.startTag("", "ItemList");
					     for (Item item: this.getList()){
					            serializer.startTag("", "Item");
					            serializer.text(item.toString());
					            serializer.endTag("", "Item");
					     }
				     serializer.endTag("", "ItemList");
				 serializer.endTag("", "XML");    
			     serializer.endDocument();
			     FileWriter fw = new FileWriter(item_folder + "/" + listName + ".xml");
			     fw.write(writer.toString());
			     fw.close();
			     return true;
		    } 
		 catch (Exception e) 
		    {
		        throw new RuntimeException(e);
		    } 
	}




	// Getters&Setters
	public String getListName() 
	{
		return listName;
	}
	public void setListName(String listName) {
		this.listName = listName;
		save();
	}
	public String getListColor() {
		return listColor;
	}
	public void setListColor(String listColor) {
		this.listColor = listColor;
		save();
	}
	public ArrayList<Item> getList() {
		return list;
	}
}
