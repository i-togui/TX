package core;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.StringWriter;
import java.util.ArrayList;

import javax.xml.parsers.DocumentBuilderFactory;

import org.xmlpull.v1.XmlPullParser;
import org.xmlpull.v1.XmlPullParserException;
import org.xmlpull.v1.XmlPullParserFactory;
import org.xmlpull.v1.XmlSerializer;

import android.graphics.Color;
import android.os.Environment;
import android.util.Log;
import android.util.Xml;

public class ListItem 
{
	
	//Attributs & Constructor
	String listName;
	String listColor;
	ArrayList<Item> list = new ArrayList<Item>();

	XmlPullParserFactory pullParserFactory;
	public final static String files_directory = "/storage/extSdCard/MM/ITEMS";
	public ListItem(String listName, String listColor) 
	{
		this.listName = listName;
		this.listColor = listColor;
		//save();
	}
	public ListItem(String listName) 
	{
		load(listName);
	}
	public ListItem() 
	{
		super();
	}
	
	//Core Functions
	public void addItem(String data)
	{
		this.list.add(new Item(data));
		//save();
	}
	public void removeItem(String data)
	{
		int tmp = findItem(data);
		if (tmp > -1)
			this.list.remove(tmp);
		//save();
	}
	public int findItem(String data)
	{
		for (int i=0;i<list.size();i++)
		{
			if (list.get(i).toString() == data ) 
				return i;
		}
		return -1;
	}
	@Override
	public String toString() 
	{
		return "ListItem [listName=" + listName + ", listColor=" + listColor
				+ ", list=" + list + "]";
	}
	public boolean load(String listName)
	{
		File item = new File(ListItem.files_directory + "/" + listName + ".xml");
		if (item.canRead())
		{
			
			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
			DocumentBuilder db = dbf.newDocumentBuilder();
			Document doc = db.parse(new FileInputStream(item););

			doc.getDocumentElement().normalize();
			NodeList nodeList = doc.getElementsByTagName(”Response”);
			/** Assign textview array lenght by arraylist size */
			int res_count = nodeList.getLength();
			for (int i = 0; i < nodeList.getLength(); i++) {
			Node node = nodeList.item(i);

			tv1.setText(node.getChildNodes().item(1).getFirstChild().getNodeValue());
			}

			} catch (Exception e) {

			tv1.setText("error" + e.getMessage());

			}       
			return true;
		}
		return false;
	}

	public boolean save()
	{
		 File item_folder = new File(ListItem.files_directory);
		 item_folder.mkdirs();
		 XmlSerializer serializer = Xml.newSerializer();
		 StringWriter writer = new StringWriter();
		 try {
				 serializer.setOutput(writer);
			     serializer.startDocument("UTF-8", true);
			     serializer.startTag("", "XML");
				     serializer.startTag("", "NameList");
				     	serializer.text(this.getListName());
				     serializer.endTag("", "NameList");
				     serializer.startTag("", "ColorList");
				     	serializer.text(this.getListColor().toString());
				     serializer.endTag("", "ColorList");				     
				     serializer.startTag("", "ItemList");
					     for (Item item: this.getList()){
					            serializer.startTag("", "Item");
					            serializer.text(item.toString());
					            serializer.endTag("", "Item");
					     }
				     serializer.endTag("", "ItemList");
				 serializer.endTag("", "XML");    
			     serializer.endDocument();
			     FileWriter fw = new FileWriter(item_folder + "/" + listName + ".xml");
			     fw.write(writer.toString());
			     fw.close();
			     return true;
		    } 
		 catch (Exception e) 
		    {
		        throw new RuntimeException(e);
		    } 
	}

	// Getters&Setters
	public String getListName() 
	{
		return listName;
	}
	public void setListName(String listName) {
		this.listName = listName;
		save();
	}
	public String getListColor() {
		return listColor;
	}
	public void setListColor(String listColor) {
		this.listColor = listColor;
		save();
	}
	public ArrayList<Item> getList() {
		return list;
	}
}
